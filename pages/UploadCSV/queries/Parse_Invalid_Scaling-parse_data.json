{
  "pluginType": "JS",
  "pluginId": "js-plugin",
  "unpublishedAction": {
    "name": "parse_data",
    "fullyQualifiedName": "Parse_Invalid_Scaling.parse_data",
    "datasource": {
      "name": "UNUSED_DATASOURCE",
      "pluginId": "js-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "UploadCSV",
    "collectionId": "UploadCSV_Parse_Invalid_Scaling",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "async () => {\n  try {\n    await Select_Invalid_Scaling.run();\n    const scale_data = Select_Invalid_Scaling.data;\n    await Select_Dockets.run();\n    const docket_set = new Set(Select_Dockets.data.map(item => item.Docket));\n    await Select_Logs.run();\n    const log_set = new Set(Select_Logs.data.map(item => item.Log));\n    await Select_Grade.run();\n    const grade_set = new Set(Select_Grade.data.map(item => item.Grade));\n    await Select_Lengths.run();\n    const length_set = new Set(Select_Lengths.data.map(item => item.Lengths));\n    await Select_Location.run();\n    const location_set = new Set(Select_Location.data.map(item => item.Lengths));\n    console.log(\"starting\");\n    const {del_log, scale} = scale_data.reduce((acc, sr) => {\n      const logs_to_go = () => acc.del_log.push([sr.Log]);\n      const valid = () => acc.scale.push([sr.Log, sr.Docket, sr.Grade, sr.Length, sr.Diameter, sr.JAS, sr.Location, sr.Date]);\n      if (!log_set.has(sr.Log)) {\n        if (sr.Status === 'Rejected') {\n          del_log();\n        } else if (!location_set.has(sr.Location) || sr.Location === 'TEST') {} else if (isNaN(sr.Docket)) {} else if (!docket_set.has(parseInt(sr.Docket))) {} else if (sr.Diameter <= 16 || sr.Diameter >= 48 || isNaN(sr.Diameter)) {} else if (!length_set.has(sr.Length)) {} else if (!grade_set.has(sr.Grade)) {} else {\n          valid();\n          logs_to_go();\n        }\n      } else {\n        logs_to_go.push();\n      }\n      return acc;\n    }, {\n      scale: [],\n      del_log: []\n    });\n    console.log(\"processed\", scale.length, del_log.length);\n    if (scale.length > 0) {\n      const data = scale.map(item => `(${item.map(val => `'${val}'`).join(',')})`).join(',');\n      Insert_Scaling.run({\n        'data': data\n      }).then(() => showAlert(\"Found Valid Scaling Entires\", 'success')).catch(error => showAlert(error, 'error'));\n    }\n    if (del_log.length > 0) {\n      const idata = del_log.map(item => `(${item.map(val => `'${val}'`).join(',')})`).join(',');\n      ;\n      Delete_Invalid_ScalingRows.run({\n        'data': idata\n      }).then(() => showAlert(\"Deleted Invalid Scaling Entires\", 'success')).catch(error => showAlert(error, 'error'));\n    }\n  } catch (error) {\n    showAlert(error, 'error');\n  }\n}",
      "jsArguments": [],
      "isAsync": true
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "async () => {\n  try {\n    await Select_Invalid_Scaling.run();\n    const scale_data = Select_Invalid_Scaling.data;\n    await Select_Dockets.run();\n    const docket_set = new Set(Select_Dockets.data.map(item => item.Docket));\n    await Select_Logs.run();\n    const log_set = new Set(Select_Logs.data.map(item => item.Log));\n    await Select_Grade.run();\n    const grade_set = new Set(Select_Grade.data.map(item => item.Grade));\n    await Select_Lengths.run();\n    const length_set = new Set(Select_Lengths.data.map(item => item.Lengths));\n    await Select_Location.run();\n    const location_set = new Set(Select_Location.data.map(item => item.Lengths));\n    console.log(\"starting\");\n    const {del_log, scale} = scale_data.reduce((acc, sr) => {\n      const logs_to_go = () => acc.del_log.push([sr.Log]);\n      const valid = () => acc.scale.push([sr.Log, sr.Docket, sr.Grade, sr.Length, sr.Diameter, sr.JAS, sr.Location, sr.Date]);\n      if (!log_set.has(sr.Log)) {\n        if (sr.Status === 'Rejected') {\n          del_log();\n        } else if (!location_set.has(sr.Location) || sr.Location === 'TEST') {} else if (isNaN(sr.Docket)) {} else if (!docket_set.has(parseInt(sr.Docket))) {} else if (sr.Diameter <= 16 || sr.Diameter >= 48 || isNaN(sr.Diameter)) {} else if (!length_set.has(sr.Length)) {} else if (!grade_set.has(sr.Grade)) {} else {\n          valid();\n          logs_to_go();\n        }\n      } else {\n        logs_to_go.push();\n      }\n      return acc;\n    }, {\n      scale: [],\n      del_log: []\n    });\n    console.log(\"processed\", scale.length, del_log.length);\n    if (scale.length > 0) {\n      const data = scale.map(item => `(${item.map(val => `'${val}'`).join(',')})`).join(',');\n      Insert_Scaling.run({\n        'data': data\n      }).then(() => showAlert(\"Found Valid Scaling Entires\", 'success')).catch(error => showAlert(error, 'error'));\n    }\n    if (del_log.length > 0) {\n      const idata = del_log.map(item => `(${item.map(val => `'${val}'`).join(',')})`).join(',');\n      ;\n      Delete_Invalid_ScalingRows.run({\n        'data': idata\n      }).then(() => showAlert(\"Deleted Invalid Scaling Entires\", 'success')).catch(error => showAlert(error, 'error'));\n    }\n  } catch (error) {\n    showAlert(error, 'error');\n  }\n}"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "UploadCSV_Parse_Invalid_Scaling.parse_data",
  "deleted": false,
  "gitSyncId": "62c64eab5a06d81bded2fac9_62d4f6905a06d81bded2fcff"
}